<!DOCTYPE html>
<html>
	<head>
		<title>Fantasy Civics</title>
		<!--<link rel="icon" type="img/png" href="style/favicon.png" style="width:30px;">-->
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<script src="https://www.gstatic.com/firebasejs/3.6.9/firebase.js"></script>
		<style>

			table td {
				padding-right: 10px;
			}

			.center {
				text-align: center;
			}

			td.center {
				width: 90px;
			}

			td.player-name {
				width: 180px;
			}

		</style>
	</head>

	<body>

		<h1>Database Testing Suite</h1>

		<script type="text/javascript" src="../assets/promise.min.js"></script>
		<script type="text/javascript" src="../assets/moment.min.js"></script>
		<script type="text/javascript" src="../assets/jquery-3.1.1.min.js"></script>
		<script type="text/javascript" src="../lib/util.js"></script>

		<!-- Five Internal Libraries  Required for Database Usage -->
		<script type="text/javascript" src="./player.js"></script>
		<script type="text/javascript" src="./league.js"></script>
		<script type="text/javascript" src="./scoring.js"></script>
		<script type="text/javascript" src="./auth.js"></script>
		<script type="text/javascript" src="./database.js"></script>

		<script type="text/javascript" src="./test-views.js"></script>
		
		<script type="text/javascript">

			var l1 = '-KdIiWEUj7_toD3MKMO_';
			var l2 = '-KdJnBQC6hc7OF9FguyQ';
			var test = '-KdYWQQsWkAVuLiIoAwN';

			var Database = InitDatabase();

			var fromDate = new Date('2/4/2017').getTime();
			var toDate = new Date('2/7/2017').getTime()
			var onDate = new Date('2/5/2017').getTime()

			function loadMatch(league){
				Database.getMatch({
					userid: 'testuser0002',
					leagueid: l1,
					on: onDate
				}).then((match) => {
					console.log('Test Get Match Response');
					console.log(match);
					var p1 = Database.getRoster({
						userid: match.home,
						leagueid: l1,
						from: match.start,
						to: match.end
					});
					var p2 = Database.getRoster({
						userid: match.away,
						leagueid: l1,
						from: match.start,
						to: match.end
					});
					Promise.all([
						p1,
						p2
					]).then((participants) => {
						var homeUser = participants[0];
						var awayUser = participants[1];
						renderBoxScore(match, homeUser, awayUser, league)
					});
				}).catch((err) => {
					console.log('Test Get Match Response');
					console.error(err);
				});
			}

			Database.getLeague({
				leagueid: l1,
				from: fromDate,
				to: toDate
			}).then((league) => {
				console.log('Test Get League Response');
				console.log(league);
				loadMatch(league);
				//
				renderSchedule(league.schedule, league, league.users);
				for(var uid in league.rosters){
					renderRosters(league.rosters[uid], uid, league);
				}
				Database.getAllPlayers({
					leagueid: league.leagueid,
					from: league.from,
					to: league.to
				}).then((allPlayers) => {
					console.log('Test Get All Players Response');
					renderPlayerScores(allPlayers, league);
				}).catch((err2) => {
					console.log('Test Get All Players Response');
					console.error(err2);
				});
			}).catch((err) => {
				console.log('Test Get League Response');
				console.error(err);
			});

			// Comment out after testing once: changes persist
			/*Database.movePlayer({
				leagueid: l1,
				userid: 'testuser0002',
				sit: 'playerid0020',
				start: 'playerid0031'
			}).then((res) => {
				console.log('Test Move Player Request');
				console.log(res);
			}).catch((err) => {
				console.log('Test Move Player Request');
				console.error(err);
			});*/

			// Comment out after testing once: changes persist
			/*Database.createLeague({
				name: 'ChiHackNight Test League',
				start: new Date('1/1/2017').getTime(),
				end: new Date('1/23/2017').getTime(),
				users: ['testuser0001', 'testuser0002', 'testuser0003'],
				weeks: 3
			}).then((response) => {
				console.log('Testing Create League');
				console.log(response);
			}).catch((err) => {
				console.log('Testing Create League');
				console.error(err);
			});*/

		</script>
	
	</body>

</html>